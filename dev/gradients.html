<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gradients · Dojo</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="Dojo logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Dojo</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Get Started</a></li><li><span class="tocitem">Creating a Mechanism</span><ul><li><a class="tocitem" href="define_mechanism.html">Defining a Mechanism</a></li><li><a class="tocitem" href="load_mechanism.html">Loading Mechanism via URDF</a></li></ul></li><li><span class="tocitem">Creating a Simulation</span><ul><li><a class="tocitem" href="define_simulation.html">Defining a Simulation</a></li><li><a class="tocitem" href="define_controller.html">Defining a Controller</a></li></ul></li><li><span class="tocitem">Environments</span><ul><li><a class="tocitem" href="load_environment.html">Load Existing Environment</a></li><li><a class="tocitem" href="define_environment.html">Defining an Environment</a></li></ul></li><li><span class="tocitem">Gradients from Simulator</span><ul><li class="is-active"><a class="tocitem" href="gradients.html">Gradients</a><ul class="internal"><li><a class="tocitem" href="#Implicit-Function-Theorem"><span>Implicit Function Theorem</span></a></li><li><a class="tocitem" href="#Dojo&#39;s-Gradient"><span>Dojo&#39;s Gradient</span></a></li><li><a class="tocitem" href="#Gradient-Comparison"><span>Gradient Comparison</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="simulation.html">Simulation</a></li><li><a class="tocitem" href="trajectory_optimization.html">Trajectory Optimization</a></li><li><a class="tocitem" href="reinforcement_learning.html">Reinforcement Learning</a></li><li><a class="tocitem" href="system_identification.html">System Identification</a></li></ul></li><li><span class="tocitem">State Representations</span><ul><li><a class="tocitem" href="maximal_representation.html">Maximal Coordinates</a></li><li><a class="tocitem" href="minimal_representation.html">Minimal Coordinates</a></li></ul></li><li><span class="tocitem">Contact Models</span><ul><li><a class="tocitem" href="contact_models.html">Overview</a></li><li><a class="tocitem" href="impact.html">Impact</a></li><li><a class="tocitem" href="nonlinear_friction.html">Nonlinear friction</a></li><li><a class="tocitem" href="linearized_friction.html">Linearized Friction</a></li></ul></li><li><span class="tocitem">Interior-Point Solver</span><ul><li><a class="tocitem" href="interior_point.html">Algorithm</a></li><li><a class="tocitem" href="solver_options.html">Solver Options</a></li></ul></li><li><a class="tocitem" href="faq.html">Frequently Asked Questions</a></li><li><a class="tocitem" href="api.html">API Documentation</a></li><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="citing.html">Citing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Gradients from Simulator</a></li><li class="is-active"><a href="gradients.html">Gradients</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="gradients.html">Gradients</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dojo-sim/Dojo.jl/blob/master/docs/src/gradients.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Gradients"><a class="docs-heading-anchor" href="#Gradients">Gradients</a><a id="Gradients-1"></a><a class="docs-heading-anchor-permalink" href="#Gradients" title="Permalink"></a></h1><h2 id="Implicit-Function-Theorem"><a class="docs-heading-anchor" href="#Implicit-Function-Theorem">Implicit Function Theorem</a><a id="Implicit-Function-Theorem-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-Function-Theorem" title="Permalink"></a></h2><p>An implicit function, <span>$r : \mathbf{R}^{n_w} \times \mathbf{R}^{n_\theta} \rightarrow \mathbf{R}^{n_w}$</span>, is defined as</p><p class="math-container">\[r(w^*; \theta) = 0,\]</p><p>for solution <span>$w^* \in \mathbf{R}^{n_w}$</span> and problem data <span>$\theta \in \mathbf{R}^{n_\theta}$</span>. At a solution point of the above equation the sensitivities of the solution with respect to the problem data, i.e., <span>$\partial w^* / \partial \theta$</span>, can be computed under certain conditions. First, we approximate the above equation to first order:</p><p class="math-container">\[  \frac{\partial r}{\partial w} \delta w + \frac{\partial r}{\partial \theta} \delta \theta = 0,\]</p><p>and then solve for the relationship:</p><p class="math-container">\[\frac{\partial w^*}{\partial \theta} = -\Big(\frac{\partial r}{\partial w}\Big)^{-1} \frac{\partial r}{\partial \theta}. \quad \quad(1)\]</p><p>In case <span>$(\partial r / \partial w)^{-1}$</span> is not well defined, (e.g., not full rank) we can either apply regularization or approximately solve (1) with, for example, a least-squares approach.</p><p>Often, Newton&#39;s method is employed to find solutions to the implicit equation and custom linear-system solvers can efficiently compute search directions for this purpose. Importantly, the factorization of <span>$\partial r / \partial w$</span> used to find a solution can be reused to compute (1) at very low computational cost using only back-substitution. Additionally, each element of the problem-data sensitivity can be computed in parallel.</p><h2 id="Dojo&#39;s-Gradient"><a class="docs-heading-anchor" href="#Dojo&#39;s-Gradient">Dojo&#39;s Gradient</a><a id="Dojo&#39;s-Gradient-1"></a><a class="docs-heading-anchor-permalink" href="#Dojo&#39;s-Gradient" title="Permalink"></a></h2><p>At a solution point, <span>$w^*(\theta, \kappa)$</span>, the sensitivity of the solution with respect to the problem data, i.e., <span>$\partial w^* / \partial \theta$</span>, is efficiently computed using the implicit-function theorem (1) to differentiate through the solver&#39;s residual.</p><p>The efficient linear-system solver used for the simulator, as well as the computation and factorization of <span>$\partial r / \partial w$</span>, is used to compute the sensitivities for each element of the problem data. Calculations over the individual columns of <span>$\partial r / \partial \theta$</span> can be performed in parallel.</p><p>The problem data for each simulation step include: the previous and current configurations, control input, and additional terms like the time step, friction coefficients, and parameters of each body. The chain rule is utilized to compute gradients with respect to the finite-difference velocities as well as transformations between minimal- and maximal-coordinate representations.</p><p>In many robotics scenarios, we are interested in gradient information through contact events. Instead of computing gradients for hard contact with zero or very small central-path parameters, we use a relaxed value from intermediate solutions <span>$w^*(\theta, \kappa &gt; 0)$</span> corresponding to a soft contact model. In practice, we find that these smooth gradients greatly improve the performance of gradient-based optimization methods.</p><h2 id="Gradient-Comparison"><a class="docs-heading-anchor" href="#Gradient-Comparison">Gradient Comparison</a><a id="Gradient-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-Comparison" title="Permalink"></a></h2><img src="./assets/gradient_comparison.png" width="500"/><p>Gradient comparison between randomized smoothing and Dojo&#39;s smooth gradients. The dynamics for a box in the <span>$XY$</span> plane that is resting on a flat surface and displaced an amount <span>$\Delta$</span> by an input <span>$F$</span> (top left). Its corresponding exact gradients are shown in black. Gradient bundles (right column) are computed using sampling schemes with varying covariances <span>$\Sigma$</span> and <span>$500$</span> samples. Dojo&#39;s gradients (middle column) are computed for different values of <span>$\kappa$</span>, corresponding to the smoothness of the contact model. Compared to the 500-sample gradient bundle, Dojo&#39;s gradients are not noisy and are a 100 times faster to compute with a single worker.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="define_environment.html">« Defining an Environment</a><a class="docs-footer-nextpage" href="simulation.html">Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.14 on <span class="colophon-date" title="Tuesday 15 March 2022 23:38">Tuesday 15 March 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

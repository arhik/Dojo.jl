<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Defining a Mechanism · Dojo</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="Dojo logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Dojo</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Get Started</a></li><li><span class="tocitem">Creating a Mechanism</span><ul><li class="is-active"><a class="tocitem" href="define_mechanism.html">Defining a Mechanism</a></li><li><a class="tocitem" href="load_mechanism.html">Loading Mechanism via URDF</a></li></ul></li><li><span class="tocitem">Creating a Simulation</span><ul><li><a class="tocitem" href="define_simulation.html">Defining a Simulation</a></li><li><a class="tocitem" href="define_controller.html">Defining a Controller</a></li><li><a class="tocitem" href="simulation_with_gradients.html">Gradients</a></li></ul></li><li><span class="tocitem">Environments</span><ul><li><a class="tocitem" href="load_environment.html">Load Existing Environment</a></li><li><a class="tocitem" href="define_environment.html">Defining an Environment</a></li><li><a class="tocitem" href="environment_simulation_gradients.html">Gradients</a></li></ul></li><li><span class="tocitem">Gradients from Simulator</span><ul><li><a class="tocitem" href="simulation_with_gradients.html">Gradients</a></li><li><a class="tocitem" href="gradients.html">Background</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="simulation.html">Simulation</a></li><li><a class="tocitem" href="trajectory_optimization.html">Trajectory Optimization</a></li><li><a class="tocitem" href="reinforcement_learning.html">Reinforcement Learning</a></li><li><a class="tocitem" href="system_identification.html">System Identification</a></li></ul></li><li><span class="tocitem">State Representations</span><ul><li><a class="tocitem" href="maximal_representation.html">Maximal Coordinates</a></li><li><a class="tocitem" href="minimal_representation.html">Minimal Coordinates</a></li></ul></li><li><span class="tocitem">Contact Models</span><ul><li><a class="tocitem" href="contact_models.html">Overview</a></li><li><a class="tocitem" href="impact.html">Impact</a></li><li><a class="tocitem" href="nonlinear_friction.html">Nonlinear friction</a></li><li><a class="tocitem" href="linearized_friction.html">Linearized Friction</a></li></ul></li><li><span class="tocitem">Interior-Point Solver</span><ul><li><a class="tocitem" href="interior_point.html">Algorithm</a></li><li><a class="tocitem" href="solver_options.html">Solver Options</a></li></ul></li><li><a class="tocitem" href="faq.html">Frequently Asked Questions</a></li><li><a class="tocitem" href="api.html">API Documentation</a></li><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="citing.html">Citing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Creating a Mechanism</a></li><li class="is-active"><a href="define_mechanism.html">Defining a Mechanism</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="define_mechanism.html">Defining a Mechanism</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dojo-sim/Dojo.jl/blob/master/docs/src/define_mechanism.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Defining-a-Mechanism"><a class="docs-heading-anchor" href="#Defining-a-Mechanism">Defining a Mechanism</a><a id="Defining-a-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-Mechanism" title="Permalink"></a></h1><p>Here, we describe how to define your own dynamical system of <a href="api.html#Dojo.Mechanism"><code>Mechanism</code></a>. After it has been defined, it will be extremely easy to simulate it, control it, perform trajectory optimization on it, or even policy optimization.</p><p>We&#39;re going to build a tippe top,</p><img src="./assets/tippetop_real.gif" width="300"/><img src="./assets/animations/tippetop.gif" width="300"/><h3 id="Build-Mechanism"><a class="docs-heading-anchor" href="#Build-Mechanism">Build Mechanism</a><a id="Build-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Build-Mechanism" title="Permalink"></a></h3><p>To do this, we need to define two methods. The first one is named <code>get_...</code> where <code>...</code> is the name of the mechanism. So here we define <code>get_tippetop</code>. This function return a <a href="api.html#Dojo.Mechanism"><code>Mechanism</code></a> and takes as input a variety of parameters like the simulation time step, gravity etc. You can add as many parameters you want. This example is typical of what you will find in Dojo.</p><p>To build the mechanism corresponding to the tippe top, we decompose it into two spherical bodies. Each body has its own spherical contact constraint with the floor. The joint between the two bodies is a <code>fixed_joint</code> and the joint between the main body and the <a href="api.html#Dojo.Origin"><code>Origin</code></a> of the frame is a floating joint.</p><pre><code class="language-julia hljs">function get_tippetop(;
    timestep=0.01,
    gravity=[0.0; 0.0; -9.81],
    friction_coefficient=0.4,
    contact_type=:nonlinear,
    T=Float64)

    # define origin
    origin = Origin{T}(name=:origin)
    # define the two bodies which will form the tippe top once assembled
    radius = 0.5
    mass = 1.0
    α = 0.2
    bodies = [
        Sphere(radius, mass, name=:sphere1, color=gray_light),
        Sphere(radius*α, mass*α^3, name=:sphere2, color=gray_light)]
    # modify inertia of the first body to ensure we obtain the desired behavior
    bodies[1].inertia = Diagonal([1.9, 2.1, 2.0])

    # define the joints, the 1st joint is between Origin and :sphere1
    # the 2nd joint is between :sphere1 and :sphere2
    joints = [
        JointConstraint(Floating(origin, bodies[1]),
                name=:floating_joint),
        JointConstraint(Fixed(bodies[1], bodies[2],
                parent_vertex=[0,0,radius],
                child_vertex=zeros(3)),
                name = :fixed_joint)]

    # define the two spherical contacts, each contact is attached to a body.
    contact_point = [0.0, 0.0, 0.0] # both contact spheres are located at the center of the bodies they are attached to.
    normal = [0.0, 0.0, 1.0] # the normal of the contact is always pointing in the upright direction because the floor is flat.
    # we specify the type of contact (impact, linear, nonlinear), the coefficient of friction, the radius of the contact sphere, etc.
    contacts = [
        contact_constraint(get_body(mechanism, :sphere1), normal,
            friction_coefficient=friction_coefficient,
            contact_point=contact_point, offset=[0.0, 0.0, radius],
            contact_type=contact_type),
        contact_constraint(get_body(mechanism, :sphere2), normal,
            friction_coefficient=friction_coefficient,
            contact_point=contact_point,
            offset=[0.0, 0.0, radius * α],
            contact_type=contact_type)
        ]

    # we build the mechanism by combining together the the origin, the bodies, the joints, and the contacts.
    mechanism = Mechanism(origin, bodies, joints, contacts,
        gravity=gravity,
        timestep=timestep)

    # we make sure that the mechanism is never initialized with its contact spheres below the ground.
    set_minimal_coordinates!(mechanism, get_joint(mechanism, :floating_joint), [0.0; 0.0; radius; zeros(3)])
    return mechanism
end</code></pre><h3 id="Initialize-Mechanism"><a class="docs-heading-anchor" href="#Initialize-Mechanism">Initialize Mechanism</a><a id="Initialize-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize-Mechanism" title="Permalink"></a></h3><p>The second method that we need to define is <code>initialize_...</code> where <code>...</code> is the name of the mechanism. So here we define <code>initialize_tippetop</code>. This function initialize the dynamical system to a certain state. This means that we set the position orientation, linear and angular velocity of each body in the mechanism.</p><pre><code class="language-julia hljs">function initialize_tippetop!(mechanism::Mechanism{T};
    body_position=zeros(3),
    body_orientation=zeros(3),
    body_linear_velocity=zeros(3),
    body_angular_velocity=zeros(3)) where T

    # we retrieve the joints from the mechanism by their names
    floating_joint = get_joint(mechanism, :floating_joint)
    fixed_joint = get_joint(mechanism, :fixed_joint)
    radius = fixed_joint.translational.vertices[1][3]

    # we set all the bodies&#39; velocities to zeros
    zero_velocity!(mechanism)
    # we set to minimal coordinates of the floating joint
    set_minimal_coordinates_velocities!(mechanism, floating_joint,
        xmin=[body_position; body_orientation; body_linear_velocity; body_angular_velocity])
    # we set to minimal coordinates of the fixed joint (this joint has zero minimal coordinate).
    set_minimal_coordinates_velocities!(mechanism, fixed_joint)
    return nothing
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Get Started</a><a class="docs-footer-nextpage" href="load_mechanism.html">Loading Mechanism via URDF »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Friday 29 April 2022 17:22">Friday 29 April 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
